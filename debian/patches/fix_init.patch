Description: adjust initscript template
 Some tweaks to the initscript template are needed for Debian packaging to work
 and to follow policy.
Author: Philipp Huebner <debalance@debian.org>

Index: ejabberd/ejabberd.init.template
===================================================================
--- ejabberd.orig/ejabberd.init.template	2014-05-14 21:32:17.046884560 +0200
+++ ejabberd/ejabberd.init.template	2014-05-14 21:35:41.731504199 +0200
@@ -16,9 +16,12 @@
 
 set -o errexit
 
-DIR=@ctlscriptpath@
+. /lib/lsb/init-functions
+
+DIR=/usr/sbin
 CTL="$DIR"/ejabberdctl
-USER=@installuser@
+USER=ejabberd
+EJABBERDRUN=/var/run/ejabberd
 
 test -x "$CTL" || {
 	echo "ERROR: ejabberd not found: $DIR"
@@ -29,11 +32,26 @@
 	exit 2
 }
 
+mkrundir()
+{
+	if [ ! -d $EJABBERDRUN ]; then
+		mkdir -p $EJABBERDRUN
+		if [ $? -ne 0 ]; then
+			echo -n " failed"
+			return
+		fi
+		chmod 0755 $EJABBERDRUN
+		chown ejabberd:ejabberd $EJABBERDRUN
+	fi
+}
+
+
 export PATH="${PATH:+$PATH:}/usr/sbin:/sbin"
 
 case "$1" in
   start)
     test -x "$CTL" || exit 0
+    mkrundir
     echo "Starting ejabberd..."
     su - $USER -c "$CTL start"
     su - $USER -c "$CTL started"
Index: ejabberd/ejabberdctl.template
===================================================================
--- ejabberd.orig/ejabberdctl.template	2014-05-14 21:32:17.046884560 +0200
+++ ejabberd/ejabberdctl.template	2014-05-14 21:32:17.042884473 +0200
@@ -13,7 +13,7 @@
 # define default environment variables
 SCRIPT_DIR=`cd ${0%/*} && pwd`
 ERL={{erl}}
-INSTALLUSER={{installuser}}
+INSTALLUSER=ejabberd
 
 # Compatibility in ZSH
 #setopt shwordsplit 2>/dev/null
