Index: ejabberd/src/ejabberd_ctl.erl
===================================================================
--- ejabberd.orig/src/ejabberd_ctl.erl
+++ ejabberd/src/ejabberd_ctl.erl
@@ -24,7 +24,21 @@
 start() ->
     case init:get_plain_arguments() of
 	[SNode | Args] ->
-	    Node = list_to_atom(SNode),
+	    case string:tokens(SNode, "@") of
+		[_Node, _Server] ->
+		    SNode1 = SNode;
+		_ ->
+		    SNode1 = case net_kernel:longnames() of
+				 true ->
+				     SNode ++ "@" ++ inet_db:gethostname() ++
+					      "." ++ inet_db:res_option(domain);
+				 false ->
+				     SNode ++ "@" ++ inet_db:gethostname();
+				 _ ->
+				     SNode
+			     end
+	    end,
+	    Node = list_to_atom(SNode1),
 	    Status = case rpc:call(Node, ?MODULE, process, [Args]) of
 			 {badrpc, Reason} ->
 			     io:format("RPC failed on the node ~p: ~p~n",
@@ -248,13 +262,14 @@
 		   Desc, NewLine]
 	  end, CmdDescs),
     io:format(
-      "Usage: ejabberdctl node command~n"
+      "Usage: ejabberdctl [--node node] command [options]~n"
       "~n"
       "Available commands:~n"
       ++ FmtCmdDescs ++
       "~n"
-      "Example:~n"
-      "  ejabberdctl ejabberd@host restart~n"
+      "Examples:~n"
+      "  ejabberdctl restart~n"
+      "  ejabberdctl --node ejabberd@host restart~n"
      ).
 
 print_vhost_usage(Host) ->
@@ -279,7 +294,7 @@
 		   Desc, NewLine]
 	  end, CmdDescs),
     io:format(
-      "Usage: ejabberdctl node vhost host command~n"
+      "Usage: ejabberdctl [--node node] vhost host command~n"
       "~n"
       "Available commands:~n"
       ++ FmtCmdDescs ++
